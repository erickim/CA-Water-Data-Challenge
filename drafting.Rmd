---
title: "Drafting"
author: "we are all eric."
date: "9/20/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message = F, warning = F, include=F}
source("R/convenience.R")
source("R/cleaning.R")
watersystems <- fetch_water_service_areas()
schools <- fetch_active_public_schools()
analyses <- fetch_water_quality_analyses()
```

```{r}
a <- systems %$% unique(system_id) %>% sort()
length(a)

b <- watersystems %$% unique(region_id) %>% sort()
length(b)

d <- intersect(a, b)
length(d)
```
```{r}
geo_matched <- geo_join(schools, watersystems, 'Longitude', 'Latitude')
1 - (geo_matched %$% mean(is.na(region_id)))
1 - (geo_matched %>% filter(EILCode == "ELEM") %$% mean(is.na(region_id)))
```
```{r}
water <- merge_water_data(watersystems, schools, analyses)
View(summarize_water_data(water, retain_geometry = F))
water %>% get_nested_column("4210006", analyses) -> a; View(a)
```




```{r}
ca_map <- 
  maps::map("state", regions = "california", plot = F, fill = T) %>% 
  sf::st_as_sf()
watersystems %>%
  ggplot(aes(fill = population)) +
  geom_sf() #+geom_sf(data = ca_map)
```


